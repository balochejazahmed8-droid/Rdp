name: RDP with Bitcoin Tools
on: workflow_dispatch

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 360
    
    steps:
    - name: Setup Tailscale & RDP
      shell: cmd
      env:
        TS_AUTH_KEY: ${{ secrets.TS_AUTH_KEY }}
      run: |
        curl -o ts.exe https://pkgs.tailscale.com/stable/tailscale-setup-latest.exe
        ts.exe /S
        timeout /t 2
        "C:\Program Files\Tailscale\tailscale.exe" up --authkey=%TS_AUTH_KEY% --hostname=github-rdp
        
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
        netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
        net user rdpuser Password123! /add
        net localgroup administrators rdpuser /add
        
    - name: Install VanitySearch
      shell: powershell
      run: |
        mkdir C:\BitcoinTools -Force
        curl -o vanity.zip https://github.com/JeanLucPons/VanitySearch/releases/download/v1.19/VanitySearch-1.19-win64.zip
        Expand-Archive -Path vanity.zip -DestinationPath C:\BitcoinTools\VanitySearch -Force
        
        "VanitySearch installed at C:\BitcoinTools\VanitySearch"
        
    - name: Show Info
      shell: cmd
      run: |
        "C:\Program Files\Tailscale\tailscale.exe" ip -4
        echo User: rdpuser
        echo Pass: Password123!
        echo Tools: C:\BitcoinTools\VanitySearch
        
    - name: Keep Running
      shell: powershell
      run: Start-Sleep -Seconds 21600
